<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åæƒ…ç»ªç²‰ç¢æœº | Mood Crusher</title>
    <style>
        /* --- æ²»æ„ˆç³»è§†è§‰é£æ ¼å®šä¹‰ --- */
        :root {
            --bg-color: #FFF9F0; /* æ¸©æš–çš„ç±³ç™½è‰² */
            --note-color: #FFFAE0; /* æŸ”å’Œçš„é¹…é»„ä¾¿ç­¾ */
            --text-color: #6B5B55; /* æ¸©æš–çš„æ·±æ£•è‰²å­—ä½“ */
            --accent-pink: #FFC6C6;
            --accent-blue: #C6E6FF;
            --accent-green: #D4F0C0;
            --shadow: 0 8px 24px rgba(149, 137, 126, 0.15);
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-color);
            font-family: 'Nunito', 'Rounded Mplus 1c', 'Microsoft YaHei', sans-serif;
            overflow: hidden; /* é˜²æ­¢æ»šåŠ¨ */
            display: flex;
            justify-content: center;
            align-items: center;
            user-select: none;
        }

        /* ä¸»å®¹å™¨ */
        .app-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        /* æ ‡é¢˜åŒº */
        header {
            text-align: center;
            margin-bottom: 20px;
            color: var(--text-color);
        }
        
        h1 {
            font-size: 1.8rem;
            margin: 0;
            font-weight: 800;
            letter-spacing: 2px;
        }

        p.subtitle {
            font-size: 0.9rem;
            opacity: 0.7;
            margin-top: 5px;
        }

        /* ä¾¿ç­¾çº¸åŒºåŸŸ */
        .note-wrapper {
            position: relative;
            width: 300px;
            height: 300px;
            margin-bottom: 40px;
            transition: transform 0.3s ease;
        }

        /* æ‹Ÿç‰©åŒ–ä¾¿ç­¾ */
        .sticky-note {
            width: 100%;
            height: 100%;
            background-color: var(--note-color);
            box-shadow: var(--shadow);
            border-radius: 4px 4px 20px 4px; /* å³ä¸‹è§’å¾®å· */
            padding: 25px;
            box-sizing: border-box;
            transform: rotate(-2deg); /* è½»å¾®å€¾æ–œæ›´è‡ªç„¶ */
            position: relative;
            transition: all 0.5s ease;
        }

        .sticky-note::after {
            content: '';
            position: absolute;
            bottom: 15px;
            right: 5px;
            width: 30px;
            height: 30px;
            background: rgba(0,0,0,0.05);
            transform: skew(10deg) rotate(5deg);
            filter: blur(5px);
            z-index: -1;
        }

        /* èƒ¶å¸¦è£…é¥° */
        .tape {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 30px;
            background-color: rgba(255, 255, 255, 0.6);
            border-left: 2px dotted rgba(0,0,0,0.05);
            border-right: 2px dotted rgba(0,0,0,0.05);
            opacity: 0.8;
            z-index: 2;
        }

        /* è¾“å…¥æ¡†æ ·å¼ */
        textarea {
            width: 100%;
            height: 100%;
            border: none;
            background: transparent;
            resize: none;
            font-size: 1.2rem;
            line-height: 1.6;
            color: var(--text-color);
            font-family: inherit;
            outline: none;
            text-align: center;
        }

        textarea::placeholder {
            color: rgba(107, 91, 85, 0.4);
        }

        /* å·¥å…·æ  */
        .tools-dock {
            display: flex;
            gap: 20px;
            background: white;
            padding: 15px 30px;
            border-radius: 50px;
            box-shadow: var(--shadow);
            transform: translateY(0);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .tool-btn {
            width: 60px;
            height: 60px;
            border: none;
            border-radius: 50%;
            background: #f8f8f8;
            cursor: pointer;
            font-size: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            position: relative;
        }

        .tool-btn:hover {
            transform: scale(1.15) translateY(-5px);
        }

        .tool-btn:active {
            transform: scale(0.95);
        }

        .tool-btn.hammer { background: var(--accent-pink); color: white; }
        .tool-btn.fan { background: var(--accent-blue); color: white; }
        .tool-btn.bubble { background: var(--accent-green); color: white; }

        /* æˆåŠŸåé¦ˆå±‚ */
        .success-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            text-align: center;
            opacity: 0;
            pointer-events: none;
            transition: all 0.5s ease;
        }

        .success-overlay.visible {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
            pointer-events: auto;
        }

        .success-emoji { font-size: 4rem; margin-bottom: 10px; display: block; }
        .success-text { font-size: 1.5rem; color: var(--text-color); font-weight: bold; }
        .restart-btn {
            margin-top: 20px;
            padding: 10px 25px;
            background: var(--text-color);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1rem;
        }

        /* Canvas ç”»å¸ƒ - ç”¨äºç‰¹æ•ˆ */
        #effectCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 20;
        }

        /* éšè—ç±» */
        .hidden {
            opacity: 0;
            pointer-events: none;
        }

    </style>
</head>
<body>

    <canvas id="effectCanvas"></canvas>

    <div class="app-container">
        <header id="header">
            <h1>åæƒ…ç»ªç²‰ç¢æœº</h1>
            <p class="subtitle">å†™ä¸‹æ¥ï¼Œé€‰ä¸ªå·¥å…·ï¼Œç„¶åå’Œå®ƒè¯´æ‹œæ‹œ</p>
        </header>

        <div class="note-wrapper" id="noteWrapper">
            <div class="sticky-note">
                <div class="tape"></div>
                <textarea id="moodInput" placeholder="åœ¨è¿™é‡Œå†™ä¸‹ä½ çš„çƒ¦æ¼...&#10;æ¯”å¦‚ï¼š&#10;â€œæœ€è¿‘å‹åŠ›å¥½å¤§â€&#10;â€œä»Šå¤©æŠŠäº‹æƒ…æç ¸äº†â€"></textarea>
            </div>
        </div>

        <div class="success-overlay" id="successOverlay">
            <span class="success-emoji">âœ¨</span>
            <div class="success-text" id="successText">å¤ªæ£’äº†ï¼Œåæƒ…ç»ªæ¸…é›¶ï¼</div>
            <button class="restart-btn" onclick="resetApp()">å†å†™ä¸€å¼ </button>
        </div>

        <div class="tools-dock" id="toolsDock">
            <button class="tool-btn hammer" onclick="crushMood('hammer')" title="é‡é”¤ç²‰ç¢">
                ğŸ”¨
            </button>
            <button class="tool-btn fan" onclick="crushMood('fan')" title="éšé£å¹æ•£">
                ğŸƒ
            </button>
            <button class="tool-btn bubble" onclick="crushMood('bubble')" title="æ°”æ³¡å°å°">
                ğŸ«§
            </button>
        </div>
    </div>

<script>
    // --- é…ç½®ä¸çŠ¶æ€ ---
    const canvas = document.getElementById('effectCanvas');
    const ctx = canvas.getContext('2d');
    const noteWrapper = document.getElementById('noteWrapper');
    const moodInput = document.getElementById('moodInput');
    const toolsDock = document.getElementById('toolsDock');
    const header = document.getElementById('header');
    const successOverlay = document.getElementById('successOverlay');
    const successText = document.getElementById('successText');

    let particles = [];
    let animationId;
    let canvasWidth, canvasHeight;

    // é¼“åŠ±è¯­åº“
    const cheers = [
        "å¤ªæ£’äº†ï¼Œåæƒ…ç»ªæ¸…é›¶ï¼",
        "æ·±å‘¼å¸ï¼Œä½ å·²ç»åšå¾—å¾ˆå¥½äº†ã€‚",
        "çƒ¦æ¼æ‹œæ‹œï¼Œå¥½è¿å¿«æ¥ï¼",
        "é›¨è¿‡å¤©æ™´ï¼Œä½ ä¼šå‘å…‰çš„ã€‚",
        "æ²¡æœ‰ä»€ä¹ˆèƒ½æ‰“è´¥å¯çˆ±çš„ä½ ï¼"
    ];

    // åˆå§‹åŒ–ç”»å¸ƒå°ºå¯¸
    function resizeCanvas() {
        canvasWidth = window.innerWidth;
        canvasHeight = window.innerHeight;
        canvas.width = canvasWidth;
        canvas.height = canvasHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // --- æ ¸å¿ƒåŠŸèƒ½ï¼šç²‰ç¢é€»è¾‘ ---
    function crushMood(type) {
        const text = moodInput.value.trim();
        
        // å¦‚æœæ²¡å†™å†…å®¹ï¼Œè½»è½»æ™ƒåŠ¨æé†’
        if (!text) {
            noteWrapper.style.transform = "rotate(-2deg) translateX(10px)";
            setTimeout(() => noteWrapper.style.transform = "rotate(-2deg) translateX(-10px)", 100);
            setTimeout(() => noteWrapper.style.transform = "rotate(-2deg)", 200);
            return;
        }

        // 1. éšè—UIï¼Œå‡†å¤‡åŠ¨ç”»
        moodInput.blur();
        toolsDock.style.transform = "translateY(100px)"; // ä¸‹æ²‰éšè—å·¥å…·æ 
        header.style.opacity = "0";

        // 2. å°†æ–‡å­—è½¬åŒ–ä¸ºç²’å­
        createParticlesFromText(text, type);

        // 3. éšè—ä¾¿ç­¾ï¼ˆäº§ç”Ÿæ–‡å­—å˜æˆç²’å­çš„é”™è§‰ï¼‰
        noteWrapper.style.opacity = "0";
        noteWrapper.style.transform = "scale(0.9) rotate(5deg)";

        // 4. å¼€å§‹ç‰©ç†æ¨¡æ‹Ÿ
        animateParticles(type);
    }

    // --- ç²’å­ç³»ç»Ÿ ---
    
    // ç”Ÿæˆæ–‡å­—ç²’å­
    function createParticlesFromText(text, type) {
        // åˆ›å»ºä¸€ä¸ªä¸´æ—¶ç”»å¸ƒæ¥åˆ†ææ–‡å­—åƒç´ 
        const tmpCanvas = document.createElement('canvas');
        const tmpCtx = tmpCanvas.getContext('2d');
        const rect = noteWrapper.getBoundingClientRect(); // è·å–ä¾¿ç­¾ä½ç½®
        
        tmpCanvas.width = rect.width;
        tmpCanvas.height = rect.height;

        // åœ¨ä¸´æ—¶ç”»å¸ƒä¸Šç»˜åˆ¶æ–‡å­— (æ¨¡æ‹Ÿ textarea çš„æ ·å¼)
        tmpCtx.fillStyle = "rgba(0,0,0,0)"; // é€æ˜èƒŒæ™¯
        tmpCtx.fillRect(0, 0, tmpCanvas.width, tmpCanvas.height);
        tmpCtx.font = "20px 'Microsoft YaHei'"; // å­—ä½“å¤§å°ä¸textareaä¸€è‡´
        tmpCtx.fillStyle = "#6B5B55"; // æ–‡å­—é¢œè‰²
        tmpCtx.textBaseline = "top";
        
        // ç®€å•çš„è‡ªåŠ¨æ¢è¡Œé€»è¾‘
        const lineHeight = 32;
        const padding = 25;
        const maxWidth = rect.width - (padding * 2);
        let words = text.split('');
        let line = '';
        let y = padding + 10; // ç¨å¾®å‘ä¸‹åç§»
        let x = padding;

        for(let n = 0; n < words.length; n++) {
            let testLine = line + words[n];
            let metrics = tmpCtx.measureText(testLine);
            let testWidth = metrics.width;
            if (testWidth > maxWidth && n > 0) {
                tmpCtx.fillText(line, x, y);
                line = words[n];
                y += lineHeight;
            } else {
                line = testLine;
            }
        }
        tmpCtx.fillText(line, x, y);

        // æ‰«æåƒç´ æ•°æ®
        const imageData = tmpCtx.getImageData(0, 0, tmpCanvas.width, tmpCanvas.height);
        const data = imageData.data;
        
        // é‡‡æ ·å¯†åº¦ï¼ˆè¶Šå°ç²’å­è¶Šå¤šï¼Œè¶Šå¡ï¼‰
        const step = 3; 

        for (let py = 0; py < tmpCanvas.height; py += step) {
            for (let px = 0; px < tmpCanvas.width; px += step) {
                // æ£€æŸ¥åƒç´ é€æ˜åº¦
                const index = (py * tmpCanvas.width + px) * 4;
                const alpha = data[index + 3];
                
                if (alpha > 128) {
                    // è¿™æ˜¯ä¸€ä¸ªæ–‡å­—åƒç´ ï¼Œåˆ›å»ºä¸€ä¸ªç²’å­
                    particles.push({
                        x: rect.left + px,
                        y: rect.top + py,
                        originX: rect.left + px,
                        originY: rect.top + py,
                        vx: (Math.random() - 0.5) * 4, // éšæœºæ°´å¹³é€Ÿåº¦
                        vy: (Math.random() - 0.5) * 4, // éšæœºå‚ç›´é€Ÿåº¦
                        size: Math.random() * 2 + 1,
                        color: `rgba(${data[index]},${data[index+1]},${data[index+2]}, ${alpha/255})`,
                        life: 1.0,
                        type: type // è®°å½•å½“å‰æ¨¡å¼
                    });
                }
            }
        }
    }

    // åŠ¨ç”»å¾ªç¯
    function animateParticles(type) {
        ctx.clearRect(0, 0, canvasWidth, canvasHeight);
        
        let activeParticles = false;

        for (let i = 0; i < particles.length; i++) {
            let p = particles[i];
            
            if (p.life > 0) {
                activeParticles = true;
                
                // --- ä¸åŒçš„ç‰©ç†è§„åˆ™ ---
                if (type === 'hammer') {
                    // ğŸ”¨ é”¤å­æ¨¡å¼ï¼šé‡åŠ›ä¸‹è½ï¼Œç²‰ç¢æ„Ÿ
                    p.vy += 0.8; // é‡åŠ›å¤§
                    p.x += p.vx;
                    p.y += p.vy;
                    p.life -= 0.01;
                    // åœ°é¢ç¢°æ’
                    if (p.y > canvasHeight) p.y = canvasHeight; 
                } 
                else if (type === 'fan') {
                    // ğŸƒ é£æ‰‡æ¨¡å¼ï¼šå‘å³é£˜é£ï¼Œå¸¦æ­£å¼¦æ³¢åŠ¨çš„é£
                    p.vx += 0.2; // é£åŠ›å‘å³åŠ é€Ÿ
                    p.x += p.vx;
                    p.y += Math.sin(p.x * 0.05) * 2 - 1; // ä¸Šä¸‹é£˜åŠ¨
                    p.life -= 0.008;
                    p.size *= 0.99; // é€æ¸å˜å°
                } 
                else if (type === 'bubble') {
                    // ğŸ«§ æ°”æ³¡æ¨¡å¼ï¼šå‘ä¸Šæ¼‚æµ®ï¼Œå˜å¤§ï¼Œé€æ˜åº¦é™ä½
                    p.y -= Math.random() * 3 + 1; // å‘ä¸Šæµ®
                    p.x += Math.sin(p.y * 0.05); // å·¦å³æ‘‡æ‘†
                    p.size += 0.05; // æ°”æ³¡å˜å¤§
                    p.life -= 0.015; // æ¶ˆå¤±å¾—å¿«ä¸€ç‚¹
                    // é¢œè‰²å˜æ·¡å˜æˆæ°”æ³¡è‰²
                    p.color = `rgba(198, 230, 255, ${p.life})`; 
                }

                // ç»˜åˆ¶ç²’å­
                ctx.fillStyle = p.color;
                ctx.beginPath();
                if(type === 'bubble') {
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    ctx.stroke(); // æ°”æ³¡æ˜¯ç©ºå¿ƒçš„
                    ctx.strokeStyle = `rgba(255, 255, 255, ${p.life})`;
                } else {
                    ctx.fillRect(p.x, p.y, p.size, p.size); // æ–¹å—åƒç´ 
                }
                ctx.fill();
            }
        }

        if (activeParticles) {
            animationId = requestAnimationFrame(() => animateParticles(type));
        } else {
            // åŠ¨ç”»ç»“æŸï¼Œå±•ç¤ºæˆåŠŸç•Œé¢
            showSuccess();
        }
    }

    // --- ç»“æŸä¸åé¦ˆ ---
    function showSuccess() {
        particles = []; // æ¸…ç©ºç²’å­
        ctx.clearRect(0, 0, canvasWidth, canvasHeight);
        
        // éšæœºå½©å¸¦ç‰¹æ•ˆï¼ˆç®€å•ç‰ˆï¼‰
        createConfetti();

        // éšæœºé€‰æ‹©ä¸€å¥é¼“åŠ±è¯­
        successText.innerText = cheers[Math.floor(Math.random() * cheers.length)];
        successOverlay.classList.add('visible');
    }

    function createConfetti() {
        // ç®€å•çš„äº”å½©çº¸å±‘
        for(let i=0; i<50; i++) {
            const x = Math.random() * canvasWidth;
            const y = Math.random() * canvasHeight - canvasHeight;
            const color = ['#FFC6C6', '#C6E6FF', '#D4F0C0', '#FFFAE0'][Math.floor(Math.random()*4)];
            
            // è¿™é‡Œå¯ä»¥åšä¸€ä¸ªç®€å•çš„çº¸å±‘ä¸‹è½åŠ¨ç”»ï¼Œä¸ºç®€åŒ–ä»£ç ï¼Œè¿™é‡Œä»…åšä¸€æ¬¡æ€§é™æ€æ¸²æŸ“ç¤ºæ„
            // è‹¥éœ€å®Œæ•´ä½“éªŒï¼Œå¯åœ¨ animateParticles ä¸­åŠ å…¥ confetti æ•°ç»„é€»è¾‘
        }
    }

    // --- é‡ç½®åº”ç”¨ ---
    function resetApp() {
        successOverlay.classList.remove('visible');
        
        // æ¢å¤ UI çŠ¶æ€
        setTimeout(() => {
            moodInput.value = ""; // æ¸…ç©ºè¾“å…¥
            noteWrapper.style.opacity = "1";
            noteWrapper.style.transform = "rotate(-2deg)";
            toolsDock.style.transform = "translateY(0)";
            header.style.opacity = "1";
        }, 300);
    }

</script>
</body>
</html>